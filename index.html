<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BO'NATURE EXPORT - Référentiel 2026</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .timeline-line-center {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 0;
            bottom: 0;
            width: 4px;
            background-color: #E2E8F0;
            z-index: 0;
        }
        
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ==========================================
        // DÉTECTEUR DE MOTS CLÉS (GLOSSAIRE)
        // ==========================================
        const glossaryAcronyms = ["EORI", "REX", "IPAFFS", "PEACH", "SPS", "EHC", "DDPP", "MRN", "GVMS", "GMR", "BCP", "BTOM", "EMEBI", "NSTI", "T1", "HACCP", "Delta IE", "DAE"];
        
        const TextWithGlossaryLinks = ({ text, onNavigate }) => {
            if (!text) return null;
            // On utilise une regex pour trouver les mots entiers sans casser la casse
            const regex = new RegExp(`\\b(${glossaryAcronyms.join('|')})\\b`, 'gi');
            const parts = text.split(regex);
            
            return (
                <>{parts.map((part, i) => {
                    const isTerm = glossaryAcronyms.find(t => t.toLowerCase() === part.toLowerCase());
                    if (isTerm && onNavigate) {
                        return (
                            <button key={i} onClick={(e) => { e.stopPropagation(); onNavigate(isTerm); }} 
                                className="inline-block text-purple-600 font-bold border-b-2 border-dotted border-purple-300 hover:text-purple-800 hover:border-purple-600 hover:bg-purple-50 transition-all px-1 rounded-sm cursor-pointer" 
                                title={`Voir la définition de ${isTerm}`}>
                                {part}
                            </button>
                        );
                    }
                    return <span key={i}>{part}</span>;
                })}</>
            );
        };

        // ==========================================
        // DONNÉES - UK (ROYAUME-UNI)
        // ==========================================
        const ukTimelineData = [
            {
                id: 0,
                type: "douane",
                category: "DOUANE & FISCAL",
                time: "PRÉALABLE (J-30)",
                title: "Enregistrement Opérateurs (EORI/REX)",
                actor: "Exportateur & Importateur",
                sender: "Entreprise",
                receiver: "Douane FR / HMRC",
                details: "Obtention des identifiants douaniers obligatoires pour interagir avec les systèmes UE et UK.",
                analysis: "Réglementation : Le code des douanes de l'Union (CDU) et le BTOM imposent une double immatriculation. L'exportateur doit avoir un EORI FR (siret) et un numéro REX (Registered Exporter) pour certifier l'origine UE sur la facture (si > 6000€). L'importateur DOIT avoir un EORI GB.",
                docs: ["EORI FR", "EORI GB", "Numéro REX"],
                warning: "Bloquant : Pas d'EORI GB = Impossible de dédouaner à l'arrivée."
            },
            {
                id: 1,
                type: "sanitaire",
                category: "SPS (PRÉALABLE)",
                time: "J-3 (ANTICIPATION)",
                title: "Système IPAFFS",
                actor: "Exportateur / Importateur",
                sender: "Opérateur",
                receiver: "DEFRA (UK)",
                details: "Déclaration d'intention d'importation dans le système britannique unique (le système historique PEACH étant désormais fermé).",
                analysis: "Depuis la pleine application du BTOM, l'importateur britannique doit obligatoirement utiliser le système IPAFFS pour pré-notifier l'arrivée de marchandises sanitaires ou phytosanitaires. C'est le point d'entrée unique de la DEFRA.",
                docs: ["Création compte IPAFFS"],
                warning: "Attention : La responsabilité de la saisie IPAFFS incombe à l'importateur britannique."
            },
            {
                id: 2,
                type: "sanitaire",
                category: "SPS (ANIMAUX)",
                time: "DÉPART (J-2)",
                title: "Certification Sanitaire (EHC)",
                actor: "Vétérinaire Officiel (DDPP)",
                sender: "DDPP",
                receiver: "Exportateur",
                details: "Inspection et émission du certificat sanitaire officiel pour les produits animaux (Fromages, Viandes).",
                analysis: "Réglementation SPS : Pour les produits classés à risque moyen ou élevé par le BTOM, un vétérinaire officiel doit certifier la marchandise (EHC). Ce document atteste du respect des standards britanniques.",
                docs: ["Certificat Sanitaire (EHC)", "Attestation NIMP 15 (Palettes)"],
                warning: "Bloquant : Pas de signature vétérinaire officielle = Refoulement immédiat à la frontière."
            },
            {
                id: 3,
                type: "sanitaire",
                category: "SPS (UK)",
                time: "J-1 (14h00)",
                title: "Pré-notification IPAFFS finale",
                actor: "Importateur UK",
                sender: "Importateur",
                receiver: "DEFRA (UK)",
                details: "Validation de la notification d'importation avec les documents définitifs.",
                analysis: "L'importateur doit finaliser sa notification au minimum 4h avant l'arrivée (flux RoRo) ou 24h avant pour le maritime. Il doit y joindre la version PDF du certificat sanitaire (EHC) signé en France.",
                docs: ["Réf. Notification IPAFFS complète"],
                warning: "Vigilance : Le poids net déclaré dans IPAFFS doit correspondre exactement au Certificat EHC."
            },
            {
                id: 4,
                type: "douane",
                category: "DOUANE",
                time: "J-1 (16h00)",
                title: "Déclarations Douane (Export/Import)",
                actor: "Déclarant (RDE)",
                sender: "RDE",
                receiver: "Delta IE / CDS",
                details: "Dépôt des déclarations fiscales de sortie (France) et d'entrée (Royaume-Uni).",
                analysis: "Flux 'Pre-lodged' : La frontière intelligente exige que les déclarations soient validées AVANT l'arrivée du camion au port. L'export se fait via le système français Delta IE (MRN Export) et l'import via le système britannique CDS (MRN Import).",
                docs: ["MRN Export (FR)", "MRN Import (UK)"],
                warning: "Bloquant : L'absence de MRN empêche la création des enveloppes logistiques de traversée."
            },
            {
                id: 5,
                type: "transport",
                category: "FRONTIÈRE INTELLIGENTE",
                time: "DÉPART (H-4)",
                title: "Enveloppe Logistique (ELO/GMR)",
                actor: "Transporteur",
                sender: "Chauffeur",
                receiver: "Ferry / Tunnel",
                details: "Appairage des données douanières avec la plaque d'immatriculation du camion.",
                analysis: "Smart Border : L'ère du papier au guichet est révolue. Le système GVMS génère un GMR (côté UK) qui consolide les déclarations d'importation. Le chauffeur présente ces codes pour embarquer.",
                docs: ["Code-barres ELO", "GMR (UK)"],
                warning: "Logistique : Le transporteur ne peut pas embarquer sans ces codes-barres valides."
            },
            {
                id: 6,
                type: "transport",
                category: "CONTRÔLE",
                time: "ARRIVÉE (H+1)",
                title: "Analyse de Risque & BCP",
                actor: "Douane UK / DEFRA",
                sender: "Système GVMS",
                receiver: "Chauffeur",
                details: "Statut délivré pendant la traversée maritime ou ferroviaire : Libéré ou Contrôle BCP.",
                analysis: "Processus BTOM : Si le système indique un contrôle sanitaire, le camion a l'obligation légale de se rendre au BCP (Border Control Post). Une inspection documentaire et physique sera effectuée selon le taux de risque.",
                docs: ["Statut Sortie (Écran bord)"],
                warning: "Pénal : Ne pas s'arrêter à un BCP alors qu'on y est convoqué constitue une infraction grave."
            }
        ];

        const ukBtomLevels = [
            {
                level: "Risque Faible (Low Risk)",
                icon: "fa-seedling",
                color: "green",
                products: "Conserves, Pâtes, Biscuits, Fruits & Légumes (majorité).",
                requirements: ["Facture Commerciale", "Pas de Certificat Sanitaire (EHC)", "Exemption IPAFFS (généralement)"],
                change: "Avantage : Logistique fluide et formalités réduites."
            },
            {
                level: "Risque Moyen (Medium Risk)",
                icon: "fa-cheese",
                color: "yellow",
                products: "Viandes, Fromages au lait cru, Lait, Charcuterie.",
                requirements: ["Certificat Sanitaire (EHC) obligatoire", "Pré-notification IPAFFS", "Contrôles physiques BCP (1-30%)"],
                change: "Contrainte : Coûts vétérinaires et risque de retard."
            },
            {
                level: "Risque Élevé (High Risk)",
                icon: "fa-cow",
                color: "red",
                products: "Animaux vivants, Végétaux destinés à la plantation.",
                requirements: ["Certificat Sanitaire Intégral", "Notification IPAFFS stricte", "Contrôle physique au BCP quasi-systématique"],
                change: "Critique : Maîtrise totale de la chaîne requise."
            }
        ];

        // ==========================================
        // DONNÉES - SCHENGEN
        // ==========================================
        const schengenData = [
            {
                id: 0,
                type: "ue",
                category: "UNION EUROPÉENNE",
                title: "Vente Intracommunautaire",
                details: "Livrer en Allemagne ou en Italie s'apparente à une livraison sur le territoire national.",
                analysis: "L'Union Douanière implique l'absence de droits de douane et de frontières physiques. Le principe de reconnaissance mutuelle garantit que les normes sanitaires françaises (Paquet Hygiène) sont valables dans toute l'UE.",
                docs: ["Facture avec mention TVA intracommunautaire", "CMR (Lettre de voiture)"],
                warning: "Attention à la conformité de l'étiquetage (langue du pays de destination).",
                icon: "fa-flag-eu"
            },
            {
                id: 1,
                type: "ue",
                category: "ADMINISTRATIF",
                title: "Déclaration EMEBI",
                details: "Obligation déclarative statistique pour le suivi des échanges intra-UE.",
                analysis: "Les entreprises dépassant le seuil d'expédition (actuellement 460 000 €/an en France) doivent soumettre mensuellement l'État Récapitulatif Mensuel des Échanges de Biens Intra-UE (EMEBI), qui a remplacé la DEB, ainsi qu'un état récapitulatif TVA.",
                docs: ["Déclaration EMEBI mensuelle en ligne"],
                warning: "Uniquement obligatoire si les seuils de chiffre d'affaires sont franchis.",
                icon: "fa-file-invoice"
            },
            {
                id: 2,
                type: "hors-ue",
                category: "SCHENGEN HORS-UE",
                title: "Suisse, Norvège, Islande...",
                details: "Ces pays font partie de l'espace Schengen (personnes) mais sont exclus de l'Union Douanière (marchandises).",
                analysis: "C'est le piège classique à l'export. On peut passer la frontière suisse sans contrôle d'identité, mais un camion de marchandises doit obligatoirement s'arrêter. Toute exportation vers la Suisse, la Norvège, l'Islande ou le Liechtenstein nécessite une déclaration d'exportation en douane (DAE). Des droits de douane, souvent basés sur le poids brut, s'appliquent à l'arrivée.",
                docs: ["Facture Export HT", "Déclaration Export (Delta IE)"],
                warning: "Anticipation indispensable pour fluidifier le passage aux points de douane fret.",
                icon: "fa-mountain"
            },
            {
                id: 3,
                type: "hors-ue",
                category: "TRANSIT LOGISTIQUE",
                title: "Régime de Transit (NSTI / T1)",
                details: "Procédure douanière permettant de suspendre les droits et taxes pendant le transport.",
                analysis: "Pour expédier de la marchandise dans un pays non-UE sans s'arrêter à la douane frontalière, ou pour la traverser (vers l'Italie via la Suisse), l'exportateur émet un T1 via le système NSTI. Le camion dédouane ainsi directement à destination chez le client ou dans un bureau de douane intérieur.",
                docs: ["Document de Transit (MRN)"],
                warning: "Nécessite une garantie financière ou l'utilisation d'un commissionnaire en douane.",
                icon: "fa-truck-fast"
            }
        ];

        // ==========================================
        // DONNÉES - COMPARATIF / STRATÉGIE
        // ==========================================
        const strategyData = [
            {
                zone: "Espace Schengen (UE)",
                countries: "Allemagne, Italie, Benelux...",
                difficulty: "Faible",
                cost: "Faible",
                time: "Fluide (J+1 / J+2)",
                details: "Marché domestique étendu sans friction.",
                pros: ["Absence de formalités douanières", "Harmonisation sanitaire (Paquet Hygiène)", "Coûts logistiques maîtrisés"],
                cons: ["Concurrence européenne intense", "Nécessité d'adapter le packaging/langue"],
                color: "green"
            },
            {
                zone: "Espace Schengen (Hors-UE)",
                countries: "Suisse, Norvège, Islande",
                difficulty: "Modérée",
                cost: "Moyen",
                time: "Moyen (Arrêt frontière)",
                details: "Marché limitrophe à fort potentiel mais barriéré.",
                pros: ["Pouvoir d'achat attractif", "Appétence pour le terroir français", "Proximité géographique réduisant l'empreinte carbone"],
                cons: ["Complexité douanière (DAE, T1)", "Droits de douane (taxes au poids) impactant la marge"],
                color: "yellow"
            },
            {
                zone: "Pays Tiers (BTOM)",
                countries: "Royaume-Uni",
                difficulty: "Élevée",
                cost: "Élevé",
                time: "Lent & Incertain",
                details: "Marché complexe post-Brexit exigeant une solide infrastructure.",
                pros: ["Volume de marché important", "Demande forte pour l'épicerie fine / fromages"],
                cons: ["Coûts fixes SPS rédhibitoires pour les petits envois", "Risque logistique (BCP)", "Charge administrative lourde (IPAFFS, EHC)"],
                color: "red"
            }
        ];

        // ==========================================
        // DONNÉES - GLOSSAIRE
        // ==========================================
        const glossaryData = [
            { term: "EORI", fullName: "Economic Operators Registration and Identification", category: "Douane", definition: "Numéro d'immatriculation douanière unique attribué aux entreprises pour interagir avec les autorités douanières de l'UE et du Royaume-Uni. Indispensable pour exporter.", icon: "fa-id-card", color: "blue" },
            { term: "REX", fullName: "Registered Exporter System", category: "Douane", definition: "Statut permettant à un exportateur d'auto-certifier l'origine européenne de ses marchandises sur la facture.", icon: "fa-file-signature", color: "blue" },
            { term: "IPAFFS", fullName: "Import of Products, Animals, Food and Feed System", category: "Sanitaire", definition: "Système informatique britannique unique obligatoire pour pré-notifier l'arrivée de produits d'origine animale ou végétale au UK.", icon: "fa-desktop", color: "green" },
            { term: "PEACH", fullName: "Procedure for Electronic Application for Certificates", category: "Sanitaire", definition: "Système britannique historique pour les végétaux, définitivement remplacé par IPAFFS en 2024. Terme obsolète.", icon: "fa-seedling-slash", color: "slate" },
            { term: "SPS", fullName: "Sanitaire et Phytosanitaire", category: "Réglementation", definition: "Ensemble des règles et contrôles visant à protéger la santé humaine, animale et végétale lors d'échanges internationaux.", icon: "fa-shield-halved", color: "red" },
            { term: "EHC", fullName: "Export Health Certificate", category: "Sanitaire", definition: "Certificat sanitaire officiel délivré et signé par un vétérinaire de la DDPP pour autoriser l'exportation de produits animaux vers des pays tiers.", icon: "fa-notes-medical", color: "green" },
            { term: "DDPP", fullName: "Direction Départementale de la Protection des Populations", category: "Institution", definition: "Service de l'État français (services vétérinaires) chargé d'inspecter et délivrer les certificats sanitaires pour l'export.", icon: "fa-building-shield", color: "slate" },
            { term: "MRN", fullName: "Movement Reference Number", category: "Douane", definition: "Numéro de suivi douanier unique (code-barres) prouvant qu'une déclaration a été enregistrée.", icon: "fa-barcode", color: "blue" },
            { term: "GVMS", fullName: "Goods Vehicle Movement Service", category: "Transport", definition: "Système informatique douanier du Royaume-Uni.", icon: "fa-server", color: "amber" },
            { term: "GMR", fullName: "Goods Movement Reference", category: "Transport", definition: "Code-barres unique généré par le GVMS regroupant toutes les déclarations d'un camion pour l'embarquement.", icon: "fa-truck-fast", color: "amber" },
            { term: "BCP", fullName: "Border Control Post", category: "Contrôle", definition: "Poste de Contrôle Frontalier britannique (ex: Sevington) où les camions sont inspectés physiquement.", icon: "fa-magnifying-glass-location", color: "red" },
            { term: "BTOM", fullName: "Border Target Operating Model", category: "Réglementation", definition: "Modèle douanier et sanitaire post-Brexit en vigueur au UK, qui classe les produits selon 3 niveaux de risque pour cibler les contrôles.", icon: "fa-scale-balanced", color: "slate" },
            { term: "EMEBI", fullName: "État Récapitulatif Mensuel des Échanges de Biens Intra-UE", category: "Fiscalité", definition: "Déclaration statistique obligatoire (remplaçant la DEB) à fournir mensuellement aux douanes françaises pour les flux au sein de l'UE.", icon: "fa-chart-pie", color: "blue" },
            { term: "NSTI", fullName: "Nouveau Système de Transit Informatisé", category: "Douane", definition: "Système européen de gestion des déclarations de transit.", icon: "fa-network-wired", color: "blue" },
            { term: "T1", fullName: "Document de Transit Externe", category: "Transport", definition: "Régime permettant de traverser une frontière en suspendant le paiement des taxes.", icon: "fa-route", color: "amber" },
            { term: "HACCP", fullName: "Hazard Analysis Critical Control Point", category: "Réglementation", definition: "Législation alimentaire européenne (Paquet Hygiène) reconnue mutuellement au sein de l'UE.", icon: "fa-hand-sparkles", color: "green" },
            { term: "Delta IE", fullName: "Delta Import-Export", category: "Douane", definition: "Système informatique des douanes françaises pour le dédouanement (remplace Delta G).", icon: "fa-laptop-code", color: "blue" },
            { term: "DAE", fullName: "Document d'Accompagnement Export", category: "Douane", definition: "Preuve papier ou numérique que la marchandise a bien été déclarée à l'exportation.", icon: "fa-file-export", color: "blue" }
        ];

        // ==========================================
        // COMPOSANTS COMMUNS
        // ==========================================
        
        const Navigation = ({ activeTab, setTab }) => (
            <div className="bg-white shadow-sm sticky top-0 z-40 border-b border-slate-200">
                <div className="max-w-6xl mx-auto px-4">
                    <div className="flex space-x-1 md:space-x-8 overflow-x-auto custom-scroll">
                        <button onClick={() => setTab('home')} className={`py-4 px-2 border-b-2 font-medium text-sm transition-colors flex items-center gap-2 whitespace-nowrap ${activeTab === 'home' ? 'border-blue-600 text-blue-600' : 'border-transparent text-slate-500 hover:text-slate-700'}`}>
                            <i className="fa-solid fa-house"></i> Accueil
                        </button>
                        <button onClick={() => setTab('uk')} className={`py-4 px-2 border-b-2 font-medium text-sm transition-colors flex items-center gap-2 whitespace-nowrap ${activeTab === 'uk' ? 'border-blue-600 text-blue-600' : 'border-transparent text-slate-500 hover:text-slate-700'}`}>
                            <i className="fa-solid fa-flag-checkered"></i> Royaume-Uni
                        </button>
                        <button onClick={() => setTab('schengen')} className={`py-4 px-2 border-b-2 font-medium text-sm transition-colors flex items-center gap-2 whitespace-nowrap ${activeTab === 'schengen' ? 'border-blue-600 text-blue-600' : 'border-transparent text-slate-500 hover:text-slate-700'}`}>
                            <i className="fa-solid fa-circle-nodes"></i> Schengen & UE
                        </button>
                        <button onClick={() => setTab('strategy')} className={`py-4 px-2 border-b-2 font-medium text-sm transition-colors flex items-center gap-2 whitespace-nowrap ${activeTab === 'strategy' ? 'border-amber-500 text-amber-600' : 'border-transparent text-slate-500 hover:text-slate-700'}`}>
                            <i className="fa-solid fa-scale-balanced"></i> Recommandations
                        </button>
                        {/* On passe "true" à setTab pour réinitialiser la recherche du glossaire si on clique sur l'onglet manuellement */}
                        <button onClick={() => setTab('glossary', true)} className={`py-4 px-2 border-b-2 font-medium text-sm transition-colors flex items-center gap-2 whitespace-nowrap ${activeTab === 'glossary' ? 'border-purple-600 text-purple-600' : 'border-transparent text-slate-500 hover:text-slate-700'}`}>
                            <i className="fa-solid fa-book-open"></i> Glossaire
                        </button>
                    </div>
                </div>
            </div>
        );

        const Modal = ({ data, onClose, onNavigateGlossary }) => {
            if (!data) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm fade-in" onClick={onClose}>
                    <div className="bg-white rounded-2xl shadow-2xl max-w-2xl w-full overflow-hidden flex flex-col max-h-[90vh]" onClick={e => e.stopPropagation()}>
                        <div className="bg-slate-900 p-8 text-white relative flex-shrink-0">
                            <div className="absolute top-0 right-0 p-32 bg-blue-600 rounded-full blur-3xl opacity-20 -mr-16 -mt-16"></div>
                            <button onClick={onClose} className="absolute top-6 right-6 text-slate-400 hover:text-white transition-colors bg-white/10 hover:bg-white/20 rounded-full w-8 h-8 flex items-center justify-center">
                                <i className="fa-solid fa-xmark text-lg"></i>
                            </button>
                            <div className="relative z-10">
                                <div className="flex items-center gap-3 mb-3">
                                    <span className="bg-blue-600 px-3 py-1 rounded-full text-xs font-bold tracking-wider shadow-sm">{data.time || "FOCUS"}</span>
                                    <span className="text-slate-300 text-xs font-bold uppercase tracking-wider">{data.category}</span>
                                </div>
                                <h2 className="text-3xl font-bold mb-2">
                                    <TextWithGlossaryLinks text={data.title} onNavigate={onNavigateGlossary} />
                                </h2>
                                <p className="text-slate-300 text-sm">
                                    <TextWithGlossaryLinks text={data.details} onNavigate={onNavigateGlossary} />
                                </p>
                            </div>
                        </div>
                        <div className="p-8 overflow-y-auto custom-scroll bg-slate-50 flex-grow">
                            {data.sender && (
                                <div className="flex items-center justify-between bg-white p-5 rounded-xl border border-slate-200 shadow-sm mb-8">
                                    <div className="text-center w-1/3">
                                        <div className="text-[10px] text-slate-400 font-bold uppercase mb-1">Émetteur</div>
                                        <div className="text-sm font-bold text-slate-800">
                                            <TextWithGlossaryLinks text={data.sender} onNavigate={onNavigateGlossary} />
                                        </div>
                                    </div>
                                    <div className="flex-1 flex justify-center text-slate-300">
                                        <i className="fa-solid fa-arrow-right-long text-xl"></i>
                                    </div>
                                    <div className="text-center w-1/3">
                                        <div className="text-[10px] text-slate-400 font-bold uppercase mb-1">Destinataire</div>
                                        <div className="text-sm font-bold text-blue-600">
                                            <TextWithGlossaryLinks text={data.receiver} onNavigate={onNavigateGlossary} />
                                        </div>
                                    </div>
                                </div>
                            )}
                            <div className="grid md:grid-cols-2 gap-8 mb-8">
                                <div>
                                    <h3 className="text-sm font-bold text-slate-800 mb-3 flex items-center">
                                        <i className="fa-solid fa-magnifying-glass text-blue-600 mr-2"></i> Analyse Réglementaire
                                    </h3>
                                    <p className="text-sm text-slate-600 leading-relaxed text-justify">
                                        <TextWithGlossaryLinks text={data.analysis} onNavigate={onNavigateGlossary} />
                                    </p>
                                </div>
                                <div>
                                    <h3 className="text-sm font-bold text-slate-800 mb-3">Documents Requis</h3>
                                    <ul className="space-y-2">
                                        {data.docs.map((doc, i) => (
                                            <li key={i} className="flex items-center gap-2 p-2 bg-white rounded border border-slate-200 text-sm shadow-sm">
                                                <i className="fa-solid fa-file-contract text-blue-500"></i>
                                                <span className="font-medium text-slate-700">
                                                    <TextWithGlossaryLinks text={doc} onNavigate={onNavigateGlossary} />
                                                </span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            </div>
                            {data.warning && (
                                <div className="bg-amber-50 border-l-4 border-amber-500 p-5 rounded-r-xl flex items-start gap-4">
                                    <div className="bg-amber-100 text-amber-600 w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0">
                                        <i className="fa-solid fa-triangle-exclamation text-lg"></i>
                                    </div>
                                    <div>
                                        <h4 className="font-bold text-amber-900 text-sm uppercase tracking-wide mb-1">Point de Vigilance</h4>
                                        <p className="text-sm text-amber-800 leading-snug">
                                            <TextWithGlossaryLinks text={data.warning} onNavigate={onNavigateGlossary} />
                                        </p>
                                    </div>
                                </div>
                            )}
                        </div>
                        <div className="bg-white p-4 border-t border-slate-200 text-center">
                            <button onClick={onClose} className="px-8 py-2 bg-slate-100 text-slate-600 font-bold rounded-full hover:bg-slate-200 transition-colors text-sm">Fermer</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- PAGE 0: HOME ---
        const HomePage = ({ setTab }) => (
            <div className="animate-fade-in flex-1 bg-slate-50">
                <div className="relative bg-slate-900 overflow-hidden">
                    <div className="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-blue-900 via-slate-900 to-black opacity-80"></div>
                    <div className="relative max-w-5xl mx-auto px-4 py-24 text-center">
                        <div className="inline-block mb-6 px-4 py-1.5 rounded-full bg-white/10 border border-white/20 text-blue-200 text-sm font-semibold backdrop-blur-sm">
                            Projet Étudiant - Synthèse 2026
                        </div>
                        <h1 className="text-4xl md:text-6xl font-bold text-white mb-6 leading-tight">
                            Stratégie & Réglementation Export<br/>
                            <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400">Du terroir savoyard à l'international</span>
                        </h1>
                        <p className="text-slate-300 text-xl max-w-2xl mx-auto mb-10 leading-relaxed">
                            Outil d'aide à la décision conçu pour démythifier les formalités douanières et sanitaires, de l'espace Schengen aux contraintes du marché britannique post-Brexit.
                        </p>
                        <button onClick={() => setTab('strategy')} className="bg-blue-600 hover:bg-blue-500 text-white px-8 py-4 rounded-full font-bold shadow-lg shadow-blue-500/30 transition-all transform hover:-translate-y-1">
                            Découvrir nos recommandations
                        </button>
                    </div>
                </div>
                
                <div className="max-w-6xl mx-auto px-4 py-20 -mt-16 relative z-10">
                    <div className="grid md:grid-cols-3 gap-8">
                        <div onClick={() => setTab('uk')} className="bg-white p-8 rounded-2xl shadow-xl border border-slate-100 hover:shadow-2xl transition-all cursor-pointer group hover:-translate-y-2">
                            <div className="w-16 h-16 bg-blue-50 rounded-2xl flex items-center justify-center text-3xl text-blue-600 mb-6 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                <i className="fa-solid fa-flag-checkered"></i>
                            </div>
                            <h3 className="text-2xl font-bold text-slate-800 mb-3">Royaume-Uni (BTOM)</h3>
                            <p className="text-slate-500 leading-relaxed mb-6">
                                Analyse du séquençage logistique et documentaire complexe : SPS, douanes, déclarations IPAFFS et certificats EHC.
                            </p>
                            <span className="text-blue-600 font-bold flex items-center gap-2 group-hover:gap-3 transition-all">
                                Analyser le processus <i className="fa-solid fa-arrow-right"></i>
                            </span>
                        </div>
                        
                        <div onClick={() => setTab('schengen')} className="bg-white p-8 rounded-2xl shadow-xl border border-slate-100 hover:shadow-2xl transition-all cursor-pointer group hover:-translate-y-2">
                            <div className="w-16 h-16 bg-emerald-50 rounded-2xl flex items-center justify-center text-3xl text-emerald-600 mb-6 group-hover:bg-emerald-600 group-hover:text-white transition-colors">
                                <i className="fa-solid fa-circle-nodes"></i>
                            </div>
                            <h3 className="text-2xl font-bold text-slate-800 mb-3">Schengen & UE</h3>
                            <p className="text-slate-500 leading-relaxed mb-6">
                                Maîtriser la distinction juridique fondamentale entre marché intérieur (UE) et douanes des pays tiers (Suisse, Norvège...).
                            </p>
                            <span className="text-emerald-600 font-bold flex items-center gap-2 group-hover:gap-3 transition-all">
                                Explorer la zone <i className="fa-solid fa-arrow-right"></i>
                            </span>
                        </div>
                        
                        <div onClick={() => setTab('strategy')} className="bg-white p-8 rounded-2xl shadow-xl border border-slate-100 hover:shadow-2xl transition-all cursor-pointer group hover:-translate-y-2">
                            <div className="w-16 h-16 bg-amber-50 rounded-2xl flex items-center justify-center text-3xl text-amber-500 mb-6 group-hover:bg-amber-500 group-hover:text-white transition-colors">
                                <i className="fa-solid fa-scale-balanced"></i>
                            </div>
                            <h3 className="text-2xl font-bold text-slate-800 mb-3">Recommandations</h3>
                            <p className="text-slate-500 leading-relaxed mb-6">
                                Matrice de décision stratégique et préconisations de développement à l'export pour une PME savoyarde.
                            </p>
                            <span className="text-amber-500 font-bold flex items-center gap-2 group-hover:gap-3 transition-all">
                                Consulter la synthèse <i className="fa-solid fa-arrow-right"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        );

        // --- PAGE 1: UK ---
        const UKPage = ({ setSelectedStep, onNavigateGlossary }) => {
            const [filter, setFilter] = useState('all');
            const [mounted, setMounted] = useState(false);
            
            useEffect(() => {
                const timer = setTimeout(() => setMounted(true), 300);
                return () => clearTimeout(timer);
            }, []);

            const filteredData = ukTimelineData.filter(item => {
                if (filter === 'all') return true;
                return item.type === filter;
            });

            const FilterBar = () => (
                <div className="flex flex-wrap justify-center gap-3 mb-12">
                    {['all', 'douane', 'sanitaire', 'transport'].map(f => (
                        <button key={f} onClick={() => setFilter(f)} className={`px-6 py-3 rounded-full text-sm font-bold transition-all flex items-center gap-2 border shadow-sm ${filter === f ? 'bg-blue-600 text-white border-blue-600 shadow-lg scale-105' : 'bg-white text-slate-600 border-slate-200 hover:bg-slate-50 hover:border-slate-300'}`}>
                            {f === 'all' ? 'Processus Complet' : f.charAt(0).toUpperCase() + f.slice(1)}
                        </button>
                    ))}
                </div>
            );

            const DetailedTimelineItem = ({ step, index }) => {
                const isLeft = index % 2 === 0;
                const TextContent = () => (
                    <div className={`flex flex-col justify-center ${isLeft ? 'items-end text-right pr-12' : 'items-start text-left pl-12'}`}>
                        <div className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2">
                            {isLeft ? <>{step.time} <i className="fa-regular fa-clock"></i></> : <><i className="fa-regular fa-clock"></i> {step.time}</>}
                        </div>
                        <h3 className="text-2xl font-bold text-slate-800 mb-2 group-hover:text-blue-600 transition-colors">
                            <TextWithGlossaryLinks text={step.title} onNavigate={onNavigateGlossary} />
                        </h3>
                        <p className="text-sm text-slate-500 leading-relaxed max-w-sm font-medium">
                            <TextWithGlossaryLinks text={step.details} onNavigate={onNavigateGlossary} />
                        </p>
                        <button className="mt-4 text-xs font-bold bg-blue-50 text-blue-600 px-4 py-2 rounded-full border border-blue-100 group-hover:bg-blue-600 group-hover:text-white transition-all flex items-center gap-2">
                            Voir l'analyse <i className="fa-solid fa-arrow-right"></i>
                        </button>
                    </div>
                );
                const CardContent = () => (
                    <div className={`relative ${isLeft ? 'pl-12' : 'pr-12'} flex ${isLeft ? 'justify-start' : 'justify-end'}`}>
                        <div className="bg-white rounded-2xl border border-slate-200 shadow-sm p-6 w-full max-w-sm group-hover:shadow-lg group-hover:border-blue-300 group-hover:-translate-y-1 transition-all">
                            <div className="flex justify-between items-center mb-4 border-b border-slate-50 pb-3">
                                <span className="bg-slate-100 text-slate-600 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">{step.category}</span>
                                <div className="flex items-center gap-2">
                                    <div className="text-[10px] text-slate-400 font-bold uppercase text-right">Responsable</div>
                                    <div className="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs"><i className="fa-solid fa-user"></i></div>
                                </div>
                            </div>
                            <div className="mb-3">
                                <div className="text-xs font-bold text-slate-400 uppercase mb-2">Documents Clés</div>
                                <div className="flex flex-wrap gap-2">
                                    {step.docs.map((doc, i) => (
                                        <span key={i} className="text-xs font-medium text-slate-600 bg-slate-50 px-2 py-1 rounded border border-slate-100 flex items-center">
                                            <i className="fa-regular fa-file-lines mr-1 text-slate-400"></i> 
                                            <TextWithGlossaryLinks text={doc} onNavigate={onNavigateGlossary} />
                                        </span>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
                return (
                    <div className="relative flex items-center justify-between w-full mb-16 md:mb-24 cursor-pointer group fade-in" onClick={() => setSelectedStep(step)}>
                        <div className="w-5/12">{isLeft ? <TextContent /> : <CardContent />}</div>
                        <div className="w-2/12 flex justify-center relative z-10">
                            <div className={`w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold shadow-xl border-4 border-slate-50 transition-all duration-300 group-hover:scale-110 group-hover:bg-blue-600 group-hover:text-white ${step.warning ? 'bg-slate-800 text-white' : 'bg-slate-700 text-white'}`}>{index + 1}</div>
                        </div>
                        <div className="w-5/12">{isLeft ? <CardContent /> : <TextContent />}</div>
                    </div>
                );
            };

            return (
                <div className="animate-fade-in">
                    <div className="bg-slate-900 text-white py-12 px-4 shadow-xl text-center relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-full opacity-10 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-blue-400 via-slate-900 to-black"></div>
                        <div className="relative max-w-4xl mx-auto z-10">
                            <div className="inline-block mb-4 px-4 py-1 rounded-full bg-blue-600/30 border border-blue-500/50 text-blue-200 text-sm font-semibold">
                                Analyse du marché britannique (2026)
                            </div>
                            <h1 className="text-3xl md:text-5xl font-bold mb-6 leading-tight">
                                Export Agroalimentaire<br/>
                                <span className="text-blue-400">Savoie <i className="fa-solid fa-arrow-right mx-2 text-2xl"></i> Royaume-Uni</span>
                            </h1>
                            <p className="text-slate-400 text-lg max-w-2xl mx-auto">
                                Séquençage détaillé des formalités depuis l'implémentation totale du Border Target Operating Model (<TextWithGlossaryLinks text="BTOM" onNavigate={onNavigateGlossary} />) et du système <TextWithGlossaryLinks text="IPAFFS" onNavigate={onNavigateGlossary} />.
                            </p>
                        </div>
                    </div>
                    
                    {/* Le graphique des probabilités restauré ! */}
                    <div className="w-full bg-white border-b border-slate-200 py-12 shadow-sm relative overflow-hidden">
                        <div className="max-w-6xl mx-auto px-4">
                            <div className="text-center mb-10">
                                <h2 className="text-3xl font-bold text-slate-800 flex items-center justify-center gap-3">
                                    <i className="fa-solid fa-chart-simple text-blue-600"></i> Probabilité de Contrôle Physique (BCP)
                                </h2>
                                <p className="text-slate-500 mt-2">Corrélation entre la classification BTOM de vos produits et le risque d'inspection douanière</p>
                            </div>
                            <div className="flex items-end justify-center h-80 gap-4 md:gap-16 relative">
                                <div className="absolute inset-0 w-full h-full pointer-events-none flex flex-col justify-between text-xs text-slate-300 z-0 px-4 md:px-20">
                                    <div className="border-b border-dashed border-slate-200 w-full h-0 flex items-center"><span className="-ml-10 font-bold">100%</span></div>
                                    <div className="border-b border-dashed border-slate-200 w-full h-0 flex items-center"><span className="-ml-10 font-bold">50%</span></div>
                                    <div className="border-b border-dashed border-slate-200 w-full h-0 flex items-center"><span className="-ml-10 font-bold">0%</span></div>
                                </div>
                                <div className="relative z-10 flex flex-col items-center group w-1/4 md:w-32 h-full justify-end">
                                    <div className="w-full md:w-24 bg-green-500 rounded-t-xl shadow-lg relative hover:brightness-110 transition-all duration-1000 ease-out cursor-pointer" style={{ height: mounted ? '5%' : '0%' }}>
                                        <div className="absolute -top-10 left-1/2 -translate-x-1/2 bg-green-100 text-green-800 text-sm font-bold px-3 py-1 rounded shadow-sm opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap border border-green-200">~1% (Documentaire)</div>
                                    </div>
                                    <div className="mt-4 text-center"><span className="block text-lg font-bold text-slate-700">Risque faible</span></div>
                                </div>
                                <div className="relative z-10 flex flex-col items-center group w-1/4 md:w-32 h-full justify-end">
                                    <div className="w-full md:w-24 bg-gradient-to-t from-yellow-500 to-yellow-300 rounded-t-xl shadow-lg relative hover:brightness-110 transition-all duration-1000 ease-out cursor-pointer" style={{ height: mounted ? '30%' : '0%' }}>
                                        <div className="absolute inset-0 opacity-10 bg-[url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQIW2NkQAKrVq36zwjjgzjwqgOx4Wy4xF27dt0HAGKTE/wtviPNAAAAAElFTkSuQmCC')]"></div>
                                        <div className="absolute -top-10 left-1/2 -translate-x-1/2 bg-yellow-100 text-yellow-800 text-sm font-bold px-3 py-1 rounded shadow-sm opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap border border-yellow-200">1% à 30% (Aléatoire)</div>
                                    </div>
                                    <div className="mt-4 text-center"><span className="block text-lg font-bold text-slate-700">Risque moyen</span></div>
                                </div>
                                <div className="relative z-10 flex flex-col items-center group w-1/4 md:w-32 h-full justify-end">
                                    <div className="w-full md:w-24 bg-red-600 rounded-t-xl shadow-lg relative hover:brightness-110 transition-all duration-1000 ease-out cursor-pointer" style={{ height: mounted ? '90%' : '0%' }}>
                                        <div className="absolute -top-10 left-1/2 -translate-x-1/2 bg-red-100 text-red-800 text-sm font-bold px-3 py-1 rounded shadow-sm opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap border border-red-200">100% (Systématique)</div>
                                    </div>
                                    <div className="mt-4 text-center"><span className="block text-lg font-bold text-slate-700">Risque élevé</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {/* Les cartes de niveaux de risque BTOM restaurées ! */}
                    <div className="max-w-6xl mx-auto px-4 mt-16 mb-20">
                        <div className="grid md:grid-cols-3 gap-6">
                            {ukBtomLevels.map((level, idx) => {
                                const colors = { green: "bg-green-50 border-green-500 text-green-700", yellow: "bg-yellow-50 border-yellow-500 text-yellow-700", red: "bg-red-50 border-red-500 text-red-700" };
                                const iconColors = { green: "bg-green-100 text-green-600", yellow: "bg-yellow-100 text-yellow-600", red: "bg-red-100 text-red-600" };
                                return (
                                    <div key={idx} className={`bg-white rounded-xl p-6 shadow-sm border-t-4 ${colors[level.color].split(' ')[1]} hover:shadow-lg transition-shadow`}>
                                        <div className="flex items-center gap-4 mb-4">
                                            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${iconColors[level.color]} text-xl`}><i className={`fa-solid ${level.icon}`}></i></div>
                                            <h3 className="font-bold text-lg text-slate-800">{level.level}</h3>
                                        </div>
                                        <div className="text-sm text-slate-600 mb-4 h-12 font-medium">{level.products}</div>
                                        <ul className="space-y-2 mb-4">
                                            {level.requirements.map((req, i) => (
                                                <li key={i} className="flex items-start gap-2 text-sm text-slate-500">
                                                    <i className={`fa-solid fa-check mt-1 ${colors[level.color].split(' ')[2]}`}></i>
                                                    <TextWithGlossaryLinks text={req} onNavigate={onNavigateGlossary} />
                                                </li>
                                            ))}
                                        </ul>
                                        <div className={`text-xs font-bold px-3 py-2 rounded ${colors[level.color]}`}>{level.change}</div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                    
                    <main className="max-w-6xl mx-auto px-4 mb-20">
                        <div className="text-center mb-10">
                            <h2 className="text-4xl font-bold text-slate-800 mb-4">Séquençage du Flux Documentaire</h2>
                            <p className="text-slate-500 text-lg max-w-2xl mx-auto mb-8">Une chronologie opérationnelle pour garantir la conformité douanière de vos expéditions. Cliquez sur les termes violets ou les cartes pour plus de détails.</p>
                            <FilterBar />
                        </div>
                        <div className="relative py-8 min-h-[500px]">
                            <div className="timeline-line-center hidden md:block"></div>
                            <div className="hidden md:block">
                                {filteredData.length > 0 ? (
                                    filteredData.map((step, index) => (
                                        <DetailedTimelineItem key={step.id} step={step} index={index} />
                                    ))
                                ) : (<div className="text-center py-20 text-slate-400 italic">Aucune étape ne correspond à ce filtre.</div>)}
                            </div>
                            
                            {/* Version Mobile (Simplifiée) restaurée */}
                            <div className="md:hidden space-y-8 pl-6 border-l-2 border-slate-200 ml-4">
                                {filteredData.map((step, index) => (
                                    <div key={step.id} className="relative cursor-pointer" onClick={() => setSelectedStep(step)}>
                                        <div className="absolute -left-[31px] top-0 w-8 h-8 rounded-full bg-slate-700 text-white flex items-center justify-center text-sm font-bold border-4 border-slate-50">{index + 1}</div>
                                        <div className="text-xs font-bold text-slate-400 uppercase mb-1">{step.time}</div>
                                        <h3 className="text-xl font-bold text-slate-800 mb-2">{step.title}</h3>
                                        <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                                            <div className="text-blue-600 text-sm font-bold mb-2">Voir l'analyse <i className="fa-solid fa-arrow-right ml-1"></i></div>
                                            <div className="text-xs text-slate-500">{step.details}</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        // --- PAGE 2: SCHENGEN ---
        const SchengenPage = ({ setSelectedStep, onNavigateGlossary }) => {
            return (
                <div className="animate-fade-in pb-20">
                    <div className="bg-slate-800 text-white py-12 px-4 shadow-xl text-center relative overflow-hidden mb-16">
                        <div className="absolute top-0 left-0 w-full h-full opacity-10 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-yellow-400 via-blue-900 to-black"></div>
                        <div className="relative max-w-4xl mx-auto z-10">
                            <div className="inline-block mb-4 px-4 py-1 rounded-full bg-yellow-400/20 border border-yellow-400/50 text-yellow-200 text-sm font-semibold">Distinction Juridique</div>
                            <h1 className="text-3xl md:text-5xl font-bold mb-6">Espace Schengen & UE</h1>
                            <p className="text-slate-300 text-lg max-w-2xl mx-auto">La différence fondamentale entre la libre circulation (Union Douanière) et les pays tiers membres de Schengen.</p>
                        </div>
                    </div>
                    
                    <div className="max-w-6xl mx-auto px-4">
                        <div className="grid md:grid-cols-2 gap-8 mb-16">
                            <div className="bg-blue-50 border-l-4 border-blue-600 p-6 rounded-r-xl shadow-sm">
                                <h3 className="text-xl font-bold text-blue-900 mb-2"><i className="fa-solid fa-star text-yellow-500 mr-2"></i> Zone A : Union Douanière (UE)</h3>
                                <p className="text-blue-800 text-sm mb-4 font-semibold">Allemagne, Italie, Espagne, Benelux...</p>
                                <ul className="space-y-2 text-sm text-blue-700">
                                    <li><i className="fa-solid fa-check mr-2"></i> Libre circulation totale des marchandises</li>
                                    <li><i className="fa-solid fa-check mr-2"></i> Absence de déclarations douanières (<TextWithGlossaryLinks text="EMEBI" onNavigate={onNavigateGlossary} /> uniquement)</li>
                                    <li><i className="fa-solid fa-check mr-2"></i> Reconnaissance mutuelle des agréments (<TextWithGlossaryLinks text="HACCP" onNavigate={onNavigateGlossary} />)</li>
                                </ul>
                            </div>
                            <div className="bg-slate-100 border-l-4 border-slate-600 p-6 rounded-r-xl shadow-sm">
                                <h3 className="text-xl font-bold text-slate-900 mb-2"><i className="fa-solid fa-mountain text-slate-500 mr-2"></i> Zone B : Schengen non-UE</h3>
                                <p className="text-slate-800 text-sm mb-4 font-semibold">Suisse, Norvège, Islande, Liechtenstein</p>
                                <ul className="space-y-2 text-sm text-slate-700">
                                    <li><i className="fa-solid fa-xmark mr-2 text-red-500"></i> Frontière douanière active (Droits et Taxes applicables)</li>
                                    <li><i className="fa-solid fa-file-contract mr-2"></i> Déclarations d'exportation (<TextWithGlossaryLinks text="DAE" onNavigate={onNavigateGlossary} />) obligatoires</li>
                                    <li><i className="fa-solid fa-road mr-2"></i> Régime de transit douanier (<TextWithGlossaryLinks text="T1" onNavigate={onNavigateGlossary} /> / <TextWithGlossaryLinks text="NSTI" onNavigate={onNavigateGlossary} />)</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div className="grid md:grid-cols-2 lg:grid-cols-2 gap-8">
                            {schengenData.map((item, idx) => (
                                <div key={idx} onClick={() => setSelectedStep(item)} className="bg-white rounded-2xl shadow-sm border border-slate-200 p-8 hover:shadow-xl hover:border-blue-400 hover:-translate-y-2 transition-all cursor-pointer group flex flex-col h-full">
                                    <div className="flex justify-between items-start mb-4">
                                        <div className={`w-14 h-14 rounded-full flex items-center justify-center text-2xl ${item.type === 'ue' ? 'bg-blue-100 text-blue-600' : 'bg-slate-100 text-slate-600'}`}><i className={`fa-solid ${item.icon}`}></i></div>
                                        <span className={`text-xs font-bold px-3 py-1 rounded-full uppercase ${item.type === 'ue' ? 'bg-blue-50 text-blue-600' : 'bg-slate-100 text-slate-600'}`}>{item.category}</span>
                                    </div>
                                    <h3 className="font-bold text-2xl text-slate-800 mb-3 group-hover:text-blue-600 transition-colors">
                                        <TextWithGlossaryLinks text={item.title} onNavigate={onNavigateGlossary} />
                                    </h3>
                                    <p className="text-slate-600 mb-6 flex-grow leading-relaxed">
                                        <TextWithGlossaryLinks text={item.details} onNavigate={onNavigateGlossary} />
                                    </p>
                                    
                                    <div className="mt-auto w-full bg-slate-50 border border-slate-200 text-center py-3 rounded-lg text-sm font-bold text-slate-600 group-hover:bg-blue-600 group-hover:text-white group-hover:border-blue-600 transition-all shadow-sm flex items-center justify-center gap-2">
                                        Voir l'analyse détaillée <i className="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- PAGE 3: STRATÉGIE ---
        const StrategyPage = () => (
            <div className="animate-fade-in pb-20">
                <div className="bg-slate-900 text-white py-12 px-4 shadow-xl text-center relative overflow-hidden mb-12">
                    <div className="absolute top-0 left-0 w-full h-full opacity-10 bg-[radial-gradient(circle_at_bottom_right,_var(--tw-gradient-stops))] from-amber-500 via-slate-900 to-black"></div>
                    <div className="relative max-w-4xl mx-auto z-10">
                        <div className="inline-block mb-4 px-4 py-1 rounded-full bg-amber-500/20 border border-amber-500/50 text-amber-200 text-sm font-semibold">
                            Synthèse Opérationnelle
                        </div>
                        <h1 className="text-3xl md:text-5xl font-bold mb-6 leading-tight">
                            Recommandations Stratégiques<br/>
                            <span className="text-amber-500">Pour Bo'Nature</span>
                        </h1>
                        <p className="text-slate-300 text-lg max-w-2xl mx-auto">
                            Matrice d'aide à la décision pour le développement commercial international des produits savoyards.
                        </p>
                    </div>
                </div>
                
                <div className="max-w-6xl mx-auto px-4">
                    <div className="overflow-x-auto bg-white rounded-xl shadow-sm border border-slate-200 mb-12">
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="bg-slate-50 border-b border-slate-200 text-slate-600 text-sm uppercase">
                                    <th className="p-4">Marché Cible</th>
                                    <th className="p-4">Complexité</th>
                                    <th className="p-4">Charge Admin.</th>
                                    <th className="p-4">Logistique</th>
                                    <th className="p-4">Avantages (Pros)</th>
                                    <th className="p-4">Contraintes (Cons)</th>
                                </tr>
                            </thead>
                            <tbody className="text-sm">
                                {strategyData.map((row, idx) => (
                                    <tr key={idx} className="border-b border-slate-100 hover:bg-slate-50">
                                        <td className="p-4 font-bold text-slate-800">{row.zone}<br/><span className="text-xs font-normal text-slate-500">{row.countries}</span></td>
                                        <td className="p-4"><span className={`px-2 py-1 rounded text-xs font-bold ${row.color === 'green' ? 'bg-green-100 text-green-700' : row.color === 'yellow' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'}`}>{row.difficulty}</span></td>
                                        <td className="p-4 font-medium text-slate-600">{row.cost}</td>
                                        <td className="p-4 text-slate-600">{row.time}</td>
                                        <td className="p-4 text-green-700"><ul className="list-disc pl-4 space-y-1">{row.pros.map(p => <li key={p}>{p}</li>)}</ul></td>
                                        <td className="p-4 text-red-600"><ul className="list-disc pl-4 space-y-1">{row.cons.map(c => <li key={c}>{c}</li>)}</ul></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    
                    {/* Les recommandations détaillées restaurées ! */}
                    <div className="bg-white rounded-2xl p-8 border border-slate-200 shadow-lg">
                        <h3 className="text-2xl font-bold text-slate-800 mb-8 text-center">Plan d'Action Séquentiel Recommandé</h3>
                        <div className="grid md:grid-cols-3 gap-8">
                            <div className="p-6 bg-slate-50 rounded-xl border border-slate-100 shadow-sm relative overflow-hidden group">
                                <div className="absolute top-0 left-0 w-1 h-full bg-green-500"></div>
                                <div className="text-center mb-4">
                                    <div className="w-12 h-12 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto text-xl font-bold">1</div>
                                </div>
                                <h4 className="font-bold text-center text-slate-800 mb-3 text-lg">Pénétration du marché intracommunautaire</h4>
                                <p className="text-sm text-slate-600 text-justify leading-relaxed">Privilégier une expansion initiale vers les marchés de l'Union Européenne (ex: Allemagne, Benelux). L'absence de barrières douanières et la reconnaissance mutuelle des normes sanitaires permettent une commercialisation fluide et à moindre coût. Phase idéale pour tester et valider la traction commerciale à l'international.</p>
                            </div>
                            
                            <div className="p-6 bg-slate-50 rounded-xl border border-slate-100 shadow-sm relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-1 h-full bg-yellow-500"></div>
                                <div className="text-center mb-4">
                                    <div className="w-12 h-12 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center mx-auto text-xl font-bold">2</div>
                                </div>
                                <h4 className="font-bold text-center text-slate-800 mb-3 text-lg">Déploiement Helvetique stratégique</h4>
                                <p className="text-sm text-slate-600 text-justify leading-relaxed">Exploiter la proximité géographique et le fort pouvoir d'achat du marché suisse ou norvégien. Bien que nécessitant l'assimilation de formalités douanières d'exportation et de transit, l'harmonisation partielle des normes et la forte demande justifient cet investissement administratif de palier.</p>
                            </div>
                            
                            <div className="p-6 bg-slate-50 rounded-xl border border-slate-100 shadow-sm relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-1 h-full bg-red-500"></div>
                                <div className="text-center mb-4">
                                    <div className="w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto text-xl font-bold">3</div>
                                </div>
                                <h4 className="font-bold text-center text-slate-800 mb-3 text-lg">Stratégie de massification UK</h4>
                                <p className="text-sm text-slate-600 text-justify leading-relaxed">Postposer l'entrée sur le marché britannique ou privilégier un modèle de distribution indirecte (B2B via un importateur). Les contraintes structurelles du BTOM génèrent des coûts fixes élevés, rendant le micro-export non viable. Une massification des flux est indispensable.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        // --- PAGE 4: GLOSSAIRE ---
        const GlossaryPage = ({ searchQuery }) => {
            const [searchTerm, setSearchTerm] = useState('');
            
            useEffect(() => {
                if (searchQuery) {
                    setSearchTerm(searchQuery);
                    window.scrollTo(0, 0);
                }
            }, [searchQuery]);

            const filteredGlossary = glossaryData
                .sort((a, b) => a.term.localeCompare(b.term))
                .filter(item => 
                    item.term.toLowerCase().includes(searchTerm.toLowerCase()) || 
                    item.fullName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    item.definition.toLowerCase().includes(searchTerm.toLowerCase())
                );

            const colorClasses = { blue: "bg-blue-50 text-blue-600 border-blue-200", green: "bg-green-50 text-green-600 border-green-200", red: "bg-red-50 text-red-600 border-red-200", amber: "bg-amber-50 text-amber-600 border-amber-200", slate: "bg-slate-100 text-slate-600 border-slate-200" };
            const iconBgClasses = { blue: "bg-blue-100 text-blue-600", green: "bg-green-100 text-green-600", red: "bg-red-100 text-red-600", amber: "bg-amber-100 text-amber-600", slate: "bg-slate-200 text-slate-600" };

            return (
                <div className="animate-fade-in pb-20">
                    <div className="bg-slate-900 text-white py-12 px-4 shadow-xl text-center relative overflow-hidden mb-12">
                        <div className="absolute top-0 left-0 w-full h-full opacity-10 bg-[radial-gradient(circle_at_top_left,_var(--tw-gradient-stops))] from-purple-500 via-slate-900 to-black"></div>
                        <div className="relative max-w-4xl mx-auto z-10">
                            <div className="inline-block mb-4 px-4 py-1 rounded-full bg-purple-500/20 border border-purple-500/50 text-purple-200 text-sm font-semibold">Lexique & Définitions Techniques</div>
                            <h1 className="text-3xl md:text-5xl font-bold mb-8">Le <span className="text-purple-400">Glossaire</span> de l'Exportateur</h1>
                            <div className="relative max-w-lg mx-auto">
                                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"><i className="fa-solid fa-magnifying-glass text-slate-400"></i></div>
                                <input type="text" placeholder="Rechercher un terme (ex: EORI)..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full pl-11 pr-4 py-4 rounded-full bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:bg-white/20 transition-all shadow-inner backdrop-blur-sm" />
                                {searchTerm && (
                                    <button onClick={() => setSearchTerm('')} className="absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-white transition-colors"><i className="fa-solid fa-xmark"></i></button>
                                )}
                            </div>
                        </div>
                    </div>

                    <div className="max-w-6xl mx-auto px-4">
                        {filteredGlossary.length === 0 ? (
                            <div className="text-center py-20 bg-white rounded-2xl border border-slate-200 shadow-sm"><i className="fa-solid fa-ghost text-4xl text-slate-300 mb-4"></i><h3 className="text-xl font-bold text-slate-700">Aucun terme trouvé</h3></div>
                        ) : (
                            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {filteredGlossary.map((item, idx) => (
                                    <div key={idx} className="bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-lg hover:-translate-y-1 hover:border-purple-300 transition-all group flex flex-col h-full">
                                        <div className="flex justify-between items-start mb-4">
                                            <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-xl shadow-sm ${iconBgClasses[item.color]}`}><i className={`fa-solid ${item.icon}`}></i></div>
                                            <span className={`text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide border ${colorClasses[item.color]}`}>{item.category}</span>
                                        </div>
                                        <h3 className="font-bold text-xl text-slate-800 mb-1">{item.term}</h3>
                                        <div className="text-xs font-semibold text-slate-400 uppercase tracking-wide mb-4 min-h-[2rem]">{item.fullName}</div>
                                        <p className="text-sm text-slate-600 leading-relaxed flex-grow">{item.definition}</p>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ==========================================
        // APP PRINCIPALE
        // ==========================================
        const App = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [selectedStep, setSelectedStep] = useState(null);
            const [glossarySearchQuery, setGlossarySearchQuery] = useState('');

            const handleNavigateGlossary = (term) => {
                setGlossarySearchQuery(term);
                setActiveTab('glossary');
                setSelectedStep(null);
            };

            const handleTabChange = (tab, resetSearch = false) => {
                setActiveTab(tab);
                if (resetSearch) setGlossarySearchQuery('');
            };

            return (
                <div className="min-h-screen pb-20 font-sans bg-slate-50">
                    <Navigation activeTab={activeTab} setTab={handleTabChange} />
                    
                    {activeTab === 'home' && <HomePage setTab={handleTabChange} />}
                    {activeTab === 'uk' && <UKPage setSelectedStep={setSelectedStep} onNavigateGlossary={handleNavigateGlossary} />}
                    {activeTab === 'schengen' && <SchengenPage setSelectedStep={setSelectedStep} onNavigateGlossary={handleNavigateGlossary} />}
                    {activeTab === 'strategy' && <StrategyPage />}
                    {activeTab === 'glossary' && <GlossaryPage searchQuery={glossarySearchQuery} />}
                    
                    <footer className="bg-slate-900 text-slate-400 mt-0 py-12 text-center border-t border-slate-800">
                        <div className="max-w-4xl mx-auto px-4"><p className="font-bold text-white mb-2">Référentiel Stratégique & Réglementaire 2026</p><p className="text-sm">Projet Étudiant</p></div>
                    </footer>
                    
                    <Modal data={selectedStep} onClose={() => setSelectedStep(null)} onNavigateGlossary={handleNavigateGlossary} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
